on: push
name: graphql

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
    - name: Run the workflow script
      run: |
        # Make Bash print the commands as it is executing them
        set -x

        # https://docs.github.com/en/graphql/reference/input-objects#committablebranch
        BRANCH='{\"nameWithOwner\":\"${{github.repository}}\",\"branchName\":\"${{github.ref}}\"}'
        
        # https://docs.github.com/en/graphql/reference/input-objects#commitmessage
        MESSAGE='{\"headline\":\"Make a test commit using GQL\",\"body\":\"This commit was created using a GitHub Actions workflow.\"}'
        
        VARIABLES='variables {\"input\":{\"branch\":'$BRANCH',\"message\":'$MESSAGE'}}'
        
        MUTATION='mutation($input:CreateCommitOnBranchInput!) { createCommitOnBranch(input:$input) { commit, ref } }'
        
        DATA='{"query":"'$MUTATION'\\n'$VARIABLES'"}'

        # Call the GitHub GQL API endpoint using the integration PAT token
        # https://docs.github.com/en/graphql/guides/forming-calls-with-graphql#communicating-with-graphql
        curl --no-progress-meter -H "Authorization: bearer ${{github.token}}" ${{github.graphql_url}} -d "$DATA"
